## Operating System (운영 체제)

### 운영체제가 하는 일

시스템 자원 관리

    응용 프로그램이 하드웨어에게 일을 시킬 수 있도록 도와주는 역할을 함.
    프로세스 관리(CPU)
    메모리 관리
    I/O(입출력) 관리 (디스크, 네트워크 등)
    응용 프로그램이 실행되고, 시스템 자원을 사용할 수 있도록 **권한**과 **사용자**를 관리

### 응용 프로그램

- 컴퓨터에게 일을 시키기 위해서는 조작할 수 있는 권한을 운영체제로 부터 부여받아야함.
- 권한을 받고난 후, 운영체제가 제공하는 기능을 사용할 수 있음.
- 응용 프로그램이 운영체제와 소통하기 위헤서는 운영체제 측에서 인터페이스를 제공해야함.
- 응용 프로그램이 시스템 자원을 이용할 수 있도록 운영체제에서 여러 함수를 제공하는 것을 **시스템 콜(System call)** 이라고 부름

### 프로세스(Process)

- 사용자가 어플리케이션을 실행하면, 운영체제로부터 실행에 필요한 메모리를 할당 받아 어플리케이션의 코드를 실행함. 이때 실행되는 어플리케이션을 프로세스라고 함.
  ex) vscode를 두 개 실행하면 두 개의 프로세스가 생성됨.
- 하나의 어플리케이션으로 여러 프로세스(다중 프로세스)를 만들기도 함.

### 스레드(Thread)

- 한 가지 작업을 실행하기 위해 순차적으로 실행한 코드를 실처럼 이어놓았다고 해서 유래된 이름
- 하나의 스레드는 코드가 실행되는 하나의 흐름.
  ex) 하나의 프로세스에 스레드가 두 개라면 코드가 실행되는 흐름이 두 개 생긴다는 의미

#### 스레드의 특징

- 프로세스 내에서 실행되는 흐름의 단위
- 각 스레드마다 call stack이 존재함

  - call stack : 실행중인 서브루틴을 저장하는 자료 구조

- 각 스레드는 독립적으로 동작함

### 멀티 스레드(Multi-Thread)

- 멀티 태스킹 : 두 가지 이상의 작업을 동시에 처리하는 것
- 운영체제에서는 프로세스마다 CPU 및 메모리 자원을 적절히 할당하고 벙렬로 실행함.
  ex) Chrome 브라우저에서 음악을 들으면서 동시에 vscode로 코딩을 진행
- 멀티 태스킹 !== 멀티 프로세스
- 하나의 프로세스 내에서 멀티 태스킹을 할 수 있게 만들어진 어플리케이션도 있는데, 이를 위한게 멀티 스레드임.
- 멀티 프로세스 : 어플리케이션 단위의 멀티 태스킹
- 멀티 스레드 : 어플리케이션 내부의 멀티 태스킹
- 멀티 스레드가 가능한 갯수는 컴퓨터 코어 갯수로 제한됨.
- 운영체제가 각 스레드를 시간에 따라 분할하며, 여러 스레드가 일정 시간마다 돌아가면서 실행되도록 함. 이런 방식을 **시분할**이라고 함

#### 동시성? 병렬성?

- 동시성(병행성) : 여러 개의 스레드가 시분할 방식으로 동시에 수행되는 것 처럼 보임.
- 병렬성 : 멀티 코어 환경에서 여러 개의 스레드가 실제로 동시에 수행됨.

### 멀티 스레드의 장점

- 메모리 공간과 시스템 자원의 소모가 줄어듬 => 시스템의 처리량이 향상됨 => 프로그램 응답 시간 단축
- 스레드간 통신에도 별도의 자원을 사용하지 않고, 전역 변수의 공간이나 동적 할당 공간인 Heap영역을 이용함. => 프로세스 간 통신 방법에 비해 스레드 간 통신 방법이 더 간단함.

### 멀티 스레드의 문제점

- 멀티 프로세스 기반일 때는 프로세스 간에 공유하는 자원이 없어서 같은 자원에 동시에 접근하는 일이 없음.
- 하지만, 멀티 스레드 기반으로 프로그래밍을 할 때는 공유하는 자원의 접근에 대해 고민이 필요하게 됨. 잘못하면 서로 다른 스레드에서 이미 사용중인 변수나 자료구조에 접근하여 엉뚱한 값을 읽어오거나, 수정하는 일이 발생할 수 있음.
  => 동기화 작업을 통해 작업 순서를 제어하고, 공유 자원에 대한 접근을 제어해야됨.
- 위 같은 문제점으로 인해 Deadlock(교착 상태)가 발생할 수 있다.

  - Deadlock (교착 상태)

    - 시스템 자원에 대한 요구가 뒤엉켜, 둘 이상의 다른 곳에서 점유하고 있는 자원을 기다리다가 아무것도 못하고 무한대기 상태에 빠짐
    - 해당 상태에 빠지지 않게 하기위해 Mutex, Semaphore가 있음.
      (이것만으로 모든 Deadlock을 해결할 수 있는건 아님)

  - Mutex (상호 배제)

    - 문제의 여지가 있는 자원을 가진 스레드들의 작동 시간이 겹치지 않게, 단독으로 실행되게 하는 기술.

  - Semaphore

    - 문제의 여지가 있는 자원을 사용할 때 사용중이라는 표시를 통해 다른 스레드가 접근하지 못하게 하는 기술.

### 멀티 스레드의 사용 예시

- 대용량 데이터의 처리 시간을 줄이기 위해 데이터를 분할하여 벙렬로 처리할 때 사용
- UI를 가지고 있는 어플리케이션에서 네트워크 통신을 하기위해 사용
- 여러 클라이언트의 요청을 처리하는 서버를 개발할 때 사용

### 멀티 스레드 vs 멀티 프로세스

- 멀티 스레드

  - 장점
    - 차지하는 메모리 공간이 비교적 적음
    - 문맥 전환이 빠름
  - 단점
    - 오류로 인해 하나의 스레드가 종료되면 전체 스레드가 종료될 수 있음

- 멀티 프로세스
  - 장점
    - 하나의 프로세스가 종료되더라도 다른 프로세스에는 영향을 주지 않음
  - 단점
    - 멀티 스레드에 비해 메모리 공간과 처리 시간을 많이 차지함

### Context Switching

**현재 실행중인 태스크(프로세스, 스레드)의 상태를 저장하고 멈춘 뒤, 다음에 실행할 태스크를 실행하는 과정**

### Context Switching의 필요성

- 만약 운영체제가 매번 하나의 태스크만 처리할 수 있다면?

  - 다음 태스크는 처리중인 태스크가 끝날 때까지 기다릴 수 밖에 없음.
  - 반응속도가 느리고 사용하기 불편함

- 동시에 사용하는 것 처럼 보이기 위해서

  - 멀티 태스킹을 통해 빠른 반응속도로 응답 가능
  - 빠른 속도로 태스크를 바꿔가며 실행하기때문에, 실시간으로 여러 태스크를 실행하는 것 처럼 보임

- 결론적으로, **CPU가 태스크를 바꿔가며 실행하기 위해 Context Switching이 필요**하게 됐음.

### Context Switching의 진행과정

- 태스크의 대부분 정보는 Register에 저장되고, Process Control Block(PCB)으로 관리되고 있음.
- 현재 실행하고 있는 태스크의 PCB 정보를 저장.
- 다음 실행할 태스크의 PCB정보를 읽어 Register에 적재하고, CPU가 이전에 진행했던 과정을 연속적으로 수행 가능
