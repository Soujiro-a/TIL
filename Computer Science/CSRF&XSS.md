## CSRF & XSS

### CSRF : Cross Site Requrest Forgery

인터넷 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정한 웹사이트에 요청하도록 만드는 공격

주로 해커들이 유저의 권한을 도용해 여러 기능을 실행하도록 함.
ex) SNS 계정으로 광고성 글 올리기

정확히 말하자면, CSRF는 **해커가 사용자 컴퓨터를 감염시키거나 서버를 해킹해서 공격하는 것이 아니다.**
CSRF가 실행되기위한 조건은 크게 2가지다.

- 사용자가 해커가 만든 피싱 사이트에 접속한 경우
- 위조 요청을 전송하는 서비스에 사용자가 로그인을 한 경우

일반적으로 자동 로그인을 해둔 경우, 피싱 사이트에 접속하게 되면서 피해를 입는 경우가 많다. 하지만, 해커가 XSS 공격을 성공시킨 사이트라면 피싱 사이트가 아니더라도 CSRF 공격이 이루어질 수 있다.

#### 대응 방법

- Refferer 검증
  백엔드 단에서 Refferer 검증을 통해 승인된 도메인은으로 요청시에만 처리하도록 함

- Security Token 사용
  사용자가 세션에 임의의 난수 값을 설정하고, 사용자가 요청시 해당 값을 포함하여 전송함.
  백엔드 단에서는 요청을 받을 때 세션에 저장된 토큰 값과 요청 파라미터로 전달받은 토큰 값이 일치하는 지 검증 과정을 거치는 방법.

### XSS : Cross Site Scription

관리자가 아닌 권한이 없는 사용자가 웹 사이트에 스크립트를 삽입하는 공격 기법

악의적으로 스크립트를 삽입, 이를 열람한 사용자의 쿠키가 해커에게 전송됨. 이렇게 탈취한 쿠키를 통해 세션 하이재킹\* 공격을 함. 해커는 세션ID를 가진 쿠키로 사용자의 계정에 로그인이 가능해짐.

- 세션 하이재킹 : 시스템에 적합한 아이디와 비밀번호를 모를 경우, 공격 대상이 이미 시스템에 접속되어 세션이 연결되어있는 상태를 가로채기하는 공격

공격 종류로는 크게 3가지가 있다.

- 지속성 : 지속적으로 피해를 입히는 유형. XSS 취얍점이 존재하는 웹 어플리케이션에 악성 스크립트를 삽입하여 열람한 사용자의 쿠키를 탈취 혹은 리다이렉션 시키는 공격을 함. 이때 삽입된 스크립트를 DB에 저장시켜 지속적으로 공격을 하기때문에 Persistent XSS라고 불림.
- 반사형 : 사용자에게 입력받은 값을 서버에서 되돌려주는 곳에서 발생. 공격자는 악의 스크립트와 함께 URL을 사용자에게 누르도록 유도하고, 누른 사용자는 이 스크립트가 실행되어 공격을 당하게 되는 유형
- DOM 기반 : 악성 스크립트가 포함된 URL을 사용자가 요청하게 되면서, 브라우저 해석 단계에서 발생하는 공격. 이 스크립트로 인해 클라이언트 측 코드가 원래 의도와 다르게 실행됨. 지속성, 반사성 공격과는 다르게 서버 측에서 탐지하기가 어려움.

#### 대응 방법

- 입출력 값 검증
  XSS Cheat Sheer에 대한 필터 목록을 만들어 모든 Cheat Sheet에 대한 대응을 가능하도록 사전에 대비. XSS 필터링을 적용 후 스크립트가 실행되는지 직접 테스트 과정을 거쳐볼 수도 있음.
- XSS 방어 라이브러리, 확장앱
  Anti XSS 라이브러리를 제공해주는 회사들이 많이 있음. 이 라이브러리는 서버단에서 추가하며, 사용자들은 각자 브라우저에서 악성 스크립트가 실행되지 않도록 확장앱을 설치하여 방어할 수 있음.
- 웹 방화벽
  웹 공격에 특화된 것으로, 다양한 Injection 공격을 한꺼번에 방어할 수 있는 장점이 있음.
