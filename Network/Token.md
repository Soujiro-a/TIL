## Token

**화폐와 같이, 사용할 수 있는 권리를 주는 것**

### 토큰 기반 인증을 사용하는 이유

- 세션기반 인증에서는 서버나 DB에 유저 정보를 담는 방식을 사용.
  =>매 요청마다 서버나 DB를 살펴봐야되는 부담이 생김.
- 이러한 부담을 클라이언트에게 넘겨줄 방법으로 고안되었음.

  - XSS & CSRF 공격이 들어올 가능성이 있는데 클라이언트에 저장하는건 위험하지 않은가?
    => 유저 정보를 암호화한 상태로 담을 수 있고, 암호화를 했기때문에 괜찮다.

### JWT : Json Web Token

**JSON포맷으로 사용자에 대한 속성을 저장하는 웹 토큰**

#### JWT의 구조

    >Header.Payload.Signature
    >1. Header
        - 어떤 종류의 토큰인가
        - 어떤 알고리즘으로 암호화하는가
        - ex) {"alg" : "HS256", "typ":"JWT"}
    >2. Payload
        - 유저의 정보
        - 권한을 부여 받았는지
        - 그 외 필요한 정보 (민감한 정보는 되도록 담지 않는게 좋다.)
        - ex) {"sub": "someInfo", "name": "kky", "iat":123412345}
    >3. Signature
        - Header, Payload를 base64인코딩한 값+Salt값으로 암호화된 값
        - ex) HMACSHA256(base64UrlEncode(header) + "." + base64UrlEncode(payload),salt)

### 토큰 기반 인증 절차

1. 클라이언트 -> 서버 : ID, Password를 이용해 로그인 요청
2. 서버 <=> DB : ID, Password확인
3. 서버 : 클라이언트에게 보낼 암호화된 토큰 하나 생성
4. 서버 => 클라이언트 : 만든 토큰을 보냄
5. 클라이언트 : 받은 토큰을 원하는 방식으로 저장. (로컬 저장소, Cookie 등)
6. 클라이언트 => 서버 : HTTP 헤더에 {Authorization:"Bearer JWT_TOKEN"}을 담아서 서버에 GET 요청을 보냄
7. 서버 => 클라이언트 : 클라이언트로부터 받은 JWT토큰을 해독 후 발급해준 토큰인 것을 확인한다면 원하는 요청에 대한 응답을 보냄

### 토큰 기반 인증의 장점

1. Statelessness & Scalability (무상태성 & 확장성)

   - 서버는 클라이언트에 대한 정보를 저장할 필요가 없음. 토큰이 해독되는지만 판단하면 됨.
   - 토큰을 헤더에 추가함으로 인증절차가 완료

2. 안정성

   - 암호화한 토큰을 사용함
   - 암호화 키를 노출 할 필요가 없어서 안전함

3. 어디서나 생성 가능

   - 반드시 토큰을 확인하는 서버에서 토큰을 만들 필요는 없음.
   - ex) 토큰 생성만 하는 서버 구축, 다른 전문업체에 토큰 관련 작업 맡기기 등

4. 권한 부여에 용이함

   - 토큰의 Payload안에 어떤 정보에 접근 가능한지 정의할 수 있음
   - ex) 갤러리 및 연락처 사용권한 부여 / 갤러리 사용 권한만 부여 / 연락처 사용 권한만 부여
